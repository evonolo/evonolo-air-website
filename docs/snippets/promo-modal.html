<!-- Promo Modal Snippet (Bootstrap 5, Animate.css) -->
<!-- Einbinden in Bootstrap Studio als "Custom Code via File" -->
<div class="modal fade" id="promoModal" tabindex="-1" aria-labelledby="promoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header border-0">
        <h5 class="modal-title visually-hidden" id="promoModalLabel">Limitierte Aktion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
      </div>
      <div class="modal-body pt-0">
        <div class="px-3 pb-3 text-center">
          <span class="badge rounded-pill text-bg-success mb-2">Limited Offer</span>
          <h3 class="fw-bold mb-2">Limitierte Aktion</h3>
          <p class="text-body-secondary mb-4">Sichere dir jetzt unser Angebot. Läuft ab in:</p>

          <!-- Countdown -->
          <div id="promoCountdown" class="d-flex justify-content-center gap-2 mb-4" aria-live="polite">
            <div class="timer-seg">
              <div class="timer-val" id="pc-hours">24</div>
              <div class="timer-label">Std</div>
            </div>
            <div class="timer-sep">:</div>
            <div class="timer-seg">
              <div class="timer-val" id="pc-min">00</div>
              <div class="timer-label">Min</div>
            </div>
            <div class="timer-sep">:</div>
            <div class="timer-seg">
              <div class="timer-val" id="pc-sec">00</div>
              <div class="timer-label">Sek</div>
            </div>
          </div>

          <a class="btn btn-success btn-lg w-100" href="/pv.html">Jetzt anfragen</a>
          <small class="d-block text-muted mt-2">Gültig 24 Stunden ab deinem ersten Besuch.</small>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Countdown-Styling (Bootstrap-nah, minimal eigenes CSS) */
  #promoModal .timer-seg { min-width: 84px; }
  #promoModal .timer-val {
    font-size: 2.25rem;
    line-height: 1;
    padding: .5rem .75rem;
    border-radius: .5rem;
    background: var(--bs-light);
    color: var(--bs-emphasis-color);
    font-weight: 700;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
  }
  #promoModal .timer-label { font-size: .75rem; color: var(--bs-secondary-color); margin-top: .25rem; }
  #promoModal .timer-sep { font-size: 2rem; line-height: 1; padding: .25rem .25rem 0; color: var(--bs-secondary-color); }
</style>

<script>
  (function () {
    var STORAGE_KEY = 'promoFirstVisitTs';
    var DURATION_MS = 24 * 60 * 60 * 1000; // 24h

    function safeNow() { return Date.now ? Date.now() : new Date().getTime(); }

    function getOrInitFirstVisit() {
      try {
        var raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          var parsed = parseInt(raw, 10);
          if (!isNaN(parsed)) return parsed;
        }
        var ts = safeNow();
        localStorage.setItem(STORAGE_KEY, String(ts));
        return ts;
      } catch (e) {
        // Fallback ohne Storage
        if (!window.__promoFirstVisitTs) window.__promoFirstVisitTs = safeNow();
        return window.__promoFirstVisitTs;
      }
    }

    function pad(n) { return n < 10 ? '0' + n : '' + n; }

    function updateCountdown(endTs) {
      var hEl = document.getElementById('pc-hours');
      var mEl = document.getElementById('pc-min');
      var sEl = document.getElementById('pc-sec');
      if (!hEl || !mEl || !sEl) return function(){};

      function render() {
        var now = safeNow();
        var diff = Math.max(0, endTs - now);
        var totalSec = Math.floor(diff / 1000);
        var hours = Math.floor(totalSec / 3600);
        var minutes = Math.floor((totalSec % 3600) / 60);
        var seconds = totalSec % 60;
        hEl.textContent = pad(hours);
        mEl.textContent = pad(minutes);
        sEl.textContent = pad(seconds);
      }

      render();
      var iv = setInterval(function () {
        render();
        if (safeNow() >= endTs) {
          clearInterval(iv);
        }
      }, 1000);

      return function () { clearInterval(iv); };
    }

    document.addEventListener('DOMContentLoaded', function () {
      var modalEl = document.getElementById('promoModal');
      if (!modalEl || typeof bootstrap === 'undefined' || !bootstrap.Modal) return;

      // Animate.css beim Öffnen hinzufügen
      modalEl.addEventListener('show.bs.modal', function () {
        var dlg = modalEl.querySelector('.modal-dialog');
        if (dlg) dlg.classList.add('animate__animated', 'animate__fadeInDown');
      });
      // Beim Schließen wieder entfernen
      modalEl.addEventListener('hidden.bs.modal', function () {
        var dlg = modalEl.querySelector('.modal-dialog');
        if (dlg) dlg.classList.remove('animate__animated', 'animate__fadeInDown');
      });

      // Countdown vorbereiten
      var firstVisit = getOrInitFirstVisit();
      var endTs = firstVisit + DURATION_MS;
      updateCountdown(endTs);

      var promo = new bootstrap.Modal(modalEl, { backdrop: true, keyboard: true });

      // 5 Sekunden verzögert anzeigen
      setTimeout(function () { promo.show(); }, 5000);
    });
  })();
</script>
